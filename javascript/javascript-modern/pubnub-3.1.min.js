(function(){
function h(){return function(){}}function i(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function m(a,b){var c=[];i(a||[],function(a,g){c.push(b(a,g))});return c}function n(a){return m(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}
function p(a){function b(a){g||(g=1,clearTimeout(l),d&&(d.onerror=d.onload=null,d.abort&&d.abort(),d=null),a&&A())}function c(){if(!j){j=1;clearTimeout(l);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}B(response)}}var d,g=0,j=0,l=setTimeout(function(){b(1)},q),A=a.a||h(),B=a.b||h();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest,d.onerror=d.onabort=function(){b(1)},d.onload=d.onloadend=c,d.timeout=q,d.open("GET",a.url.join(r),!0),d.send()}catch(f){return b(0),
p(a)}return b}
function s(a){var b={},c=a.publish_key||"",d=a.subscribe_key||"",g=a.ssl?"s":"",j="http"+g+"://"+(a.origin||"pubsub.pubnub.com"),l={history:function(a,b){var b=a.callback||b,c=a.limit||100,e=a.channel;e&&b&&p({url:[j,"history",d,n(e),0,c],b:function(a){b(a)},a:function(a){b(a)}})},time:function(a){p({url:[j,"time",0],b:function(b){a(b[0])},a:function(){a(0)}})},uuid:function(a){p({url:["http"+g+"://pubnub-prod.appspot.com/uuid"],b:function(b){a(b[0])},a:function(){a(0)}})},publish:function(a,b){var b=
b||a.callback||h(),f=a.message,e=a.channel;f&&e&&c&&(f=JSON.stringify(f),f=[j,"publish",c,d,0,n(e),0,n(f)],p({b:function(a){b(a)},a:function(){b([0,"Disconnected"])},url:f}))},unsubscribe:function(a){a=a.channel;a in b&&(b[a].c=0,b[a].d&&b[a].d(0))},subscribe:function(a,c){function f(){b[e].c&&(b[e].d=p({f:0,url:[D,"subscribe",d,n(e),0,w],a:function(){k||(k=1,E());setTimeout(f,1E3);l.time(function(a){a&&k&&(k=0,x());a||F()})},b:function(a){b[e].c&&(y||(y=1,G()),k&&(k=0,x()),g=t.set(d+e,w=g&&t.get(d+
e)||a[1]),i(a[0],function(b){c(b,a)}),setTimeout(f,10))}}))}var e=a.channel,c=c||a.callback,g=a.restore,w=0,F=a.error||h(),G=a.connect||h(),x=a.reconnect||h(),E=a.disconnect||h(),k=0,y=0,D=u(j);e&&c&&d&&(e in b||(b[e]={}),b[e].c||(b[e].c=1,f()))},xdr:p,db:t,each:i,map:m,events:v};return l}var t,z="undefined"!=typeof localStorage&&localStorage;
t={get:function(a){try{return z?z.getItem(a):-1==document.cookie.indexOf(a)?null:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||null}catch(b){}},set:function(a,b){try{if(z)return z.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};var r="/",q=31E4,u,C=Math.floor(9*Math.random())+1;u=function(a){return 0<a.indexOf("pubsub")&&a.replace("pubsub","ps"+(10>++C?C:C=1))||a};
var v={list:{},unbind:function(a){v.list[a]=[]},bind:function(a,b){(v.list[a]=v.list[a]||[]).push(b)},fire:function(a,b){i(v.list[a]||[],function(a){a(b)})}};"undefined"!==typeof module&&(module.g=s)||"undefined"!==typeof exports&&(exports.e=s)||(PUBNUB=s);
})();

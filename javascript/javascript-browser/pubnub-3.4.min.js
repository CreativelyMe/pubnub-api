(function(){
function l(){return function(){}}
window.JSON&&window.JSON.stringify||function(){function a(a){b.lastIndex=0;return b.test(a)?'"'+a.replace(b,function(a){var b=g[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(b,g){var i,h,j,k,r=e,n,d=g[b];d&&("object"===typeof d&&"function"===typeof d.toJSON)&&(d=d.toJSON(b));"function"===typeof q&&(d=q.call(g,b,d));switch(typeof d){case "string":return a(d);case "number":return isFinite(d)?String(d):"null";case "boolean":case "null":return String(d);
case "object":if(!d)return"null";e+=f;n=[];if("[object Array]"===Object.prototype.toString.apply(d)){k=d.length;for(i=0;i<k;i+=1)n[i]=c(i,d)||"null";j=0===n.length?"[]":e?"[\n"+e+n.join(",\n"+e)+"\n"+r+"]":"["+n.join(",")+"]";e=r;return j}if(q&&"object"===typeof q){k=q.length;for(i=0;i<k;i+=1)h=q[i],"string"===typeof h&&(j=c(h,d))&&n.push(a(h)+(e?": ":":")+j)}else for(h in d)Object.hasOwnProperty.call(d,h)&&(j=c(h,d))&&n.push(a(h)+(e?": ":":")+j);j=0===n.length?"{}":e?"{\n"+e+n.join(",\n"+e)+"\n"+
r+"}":"{"+n.join(",")+"}";e=r;return j}}window.JSON||(window.JSON={});"function"!==typeof String.prototype.toJSON&&(String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,f,g={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},q;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,
b,g){var h;f=e="";if("number"===typeof g)for(h=0;h<g;h+=1)f+=" ";else"string"===typeof g&&(f=g);if((q=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return c("",{"":a})});"function"!==typeof JSON.parse&&(JSON.parse=function(a){return eval("("+a+")")})}();function p(){var a=1;return"x"+ ++a+""+ +new Date}function s(){return+new Date}var v,x=Math.floor(20*Math.random());
v=function(a){return 0<a.indexOf("pubsub")&&a.replace("pubsub","ps"+(20>++x?x:x=1))||a};function aa(a,c){function b(){f+c>s()?(clearTimeout(e),e=setTimeout(b,c)):(f=s(),a())}var e,f=0;return b}function C(a,c){if(a&&c)if("undefined"!=typeof a[0])for(var b=0,e=a.length;b<e;)c.call(a[b],a[b],b++);else for(b in a)a.hasOwnProperty&&a.hasOwnProperty(b)&&c.call(a[b],b,a[b])}function D(a,c){var b=[];C(a||[],function(a,f){b.push(c(a,f))});return b}
function ba(a,c){var b=[];C(a||[],function(a){c(a)&&b.push(a)});return b}var G={list:{},unbind:function(a){G.list[a]=[]},bind:function(a,c){(G.list[a]=G.list[a]||[]).push(c)},fire:function(a,c){C(G.list[a]||[],function(a){a(c)})}};function ca(a,c){return a.replace(/{([\w\-]+)}/g,function(a,e){return c[e]||a})}var H=Math.floor(20*Math.random());v=function(a){return 0<a.indexOf("pubsub")&&a.replace("pubsub","ps"+(20>++H?H:H=1))||a};
function J(a){return D(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function K(a){var c=[];C(a,function(a,e){e.f&&c.push(a)});return c.sort()}SECOND=1E3;
if(!window.PUBNUB){var L=function(a){return document.getElementById(a)},M=function(a,c){var b=[];C(a.split(/\s+/),function(a){C((c||document).getElementsByTagName(a),function(a){b.push(a)})});return b},N=function(a,c,b){C(a.split(","),function(a){function f(a){a||(a=window.event);b(a)||(a.cancelBubble=!0,a.returnValue=!1,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}c.addEventListener?c.addEventListener(a,f,!1):c.attachEvent?c.attachEvent("on"+a,f):c["on"+a]=f})},O=
function(){return M("head")[0]},P=function(a,c,b){if(b)a.setAttribute(c,b);else return a&&a.getAttribute&&a.getAttribute(c)},Q=function(a,c){for(var b in c)if(c.hasOwnProperty(b))try{a.style[b]=c[b]+(0<"|width|height|top|left|".indexOf(b)&&"number"==typeof c[b]?"px":"")}catch(e){}},R=function(a){return document.createElement(a)},da=function(){return S||U()?0:p()},X=function(a){function c(a,b){A||(A=1,a||I(b),d.onerror=null,clearTimeout(F),setTimeout(function(){a&&t();var b=L(m),c=b&&b.parentNode;
c&&c.removeChild(b)},SECOND))}if(S||U()){a:{var b,e,f=function(){if(!q){q=1;clearTimeout(y);try{e=JSON.parse(b.responseText)}catch(a){return j(1)}h(e)}},g=0,q=0,u=a.timeout||V,y=setTimeout(function(){j(1)},u),i=a.b||l(),h=a.c||l(),j=function(a){g||(g=1,clearTimeout(y),b&&(b.onerror=b.onload=null,b.abort&&b.abort(),b=null),a&&i())};try{b=U()||window.XDomainRequest&&new XDomainRequest||new XMLHttpRequest;b.onerror=b.onabort=function(){j(1)};b.onload=b.onloadend=f;b.timeout=u;var k=a.url.join(W);if(a.data){var f=
[],r,k=k+"?";for(r in a.data)f.push(r+"="+a.data[r]);k+=f.join(fa)}b.open("GET",k,typeof("undefined"===a.g));b.send()}catch(n){j(0);S=0;a=X(a);break a}a=j}return a}var d=R("script"),k=a.a,m=p(),A=0,F=setTimeout(function(){c(1)},a.timeout||V),t=a.b||l(),I=a.c||l();window[k]=function(a){c(0,a)};a.g||(d[ga]=ga);d.onerror=function(){c(1)};d.src=a.url.join(W);if(a.data){k=[];d.src+="?";for(key in a.data)k.push(key+"="+a.data[key]);d.src+=k.join(fa)}P(d,"id",m);O().appendChild(d);return c},U=function(){if(!ha.get)return 0;
var a={id:U.id++,send:l(),abort:function(){a.id={}},open:function(c,b){U[a.id]=a;ha.get(a.id,b)}};return a},ga="async",W="/",fa="&",V=1E4,S=-1==navigator.userAgent.indexOf("MSIE 6");window.console||(window.console=window.console||{});console.log||(console.log=console.error=(window.opera||{}).postError||l());var Y,Z=window.localStorage;Y={get:function(a){try{return Z?Z.getItem(a):-1==document.cookie.indexOf(a)?null:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||null}catch(c){}},set:function(a,
c){try{if(Z)return Z.setItem(a,c)&&0;document.cookie=a+"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(b){}}};var $=L("pubnub")||{},ia=function(a){function c(){}function b(){}function e(a){C(K(g),function(b){(b=g[b])&&a(b)})}var f=a.subscribe_key||"";a.uuid||Y.get(f+"uuid");f={xdr:X,db:Y,each:C,map:D,grep:ba,css:Q,$:L,create:R,bind:N,supplant:ca,head:O,search:M,attr:P,now:s,unique:p,events:G,updater:aa,init:ia};a.xdr=X;a.db=Y;a.jsonp_cb=da;a.bind_leave=function(){N("beforeunload",window,
function(){each_channel(l());return!0})};var g={},q=[],u=0,y="-pnpres",i=0,h=0,j=0,k=0,r=0,n=0,d=a.publish_key||"",m=a.subscribe_key||"",A=a.ssl?"s":"",F=a.db||{set:l(),get:l()},t=a.jsonp_cb||function(){return 0},I=a.bind_leave||l(),z=a.xdr,E=a.uuid||F.get(m+"uuid")||"",w="http"+A+"://"+(a.origin||"pubsub.pubnub.com"),B={history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||l(),f=a.channel,g=a.start,k=a.end,h={},j=t();if(!f)return error("Missing Channel");
if(!b)return error("Missing Callback");if(!m)return error("Missing Subscribe Key");h.count=c;h.reverse=d;g&&(h.start=g);k&&(h.end=k);z({a:j,data:h,c:function(a){b(a)},b:e,url:[w,"v2","history","sub-key",m,"channel",J(f)]})},replay:function(a){var b=b||a.callback||l(),c=a.source,e=a.destination,f=a.stop,g=a.start,h=a.end,k=a.reverse,a=a.limit,j=t(),i={};if(!c)return error("Missing Source Channel");if(!e)return error("Missing Destination Channel");if(!d)return error("Missing Publish Key");if(!m)return error("Missing Subscribe Key");
"0"!=j&&(i.callback=j);f&&(i.stop="all");k&&(i.reverse="true");g&&(i.start=g);h&&(i.end=h);a&&(i.count=a);z({a:j,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[w,"v1","replay",d,m,c,e],data:i})},time:function(a){var b=t(),c=v(w);z({a:b,url:[c,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},uuid:function(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b},publish:function(a,
b){var b=b||a.callback||l(),c=a.message,e=a.channel,f=t();if(!c)return error("Missing Message");if(!e)return error("Missing Channel");if(!d)return error("Missing Publish Key");if(!m)return error("Missing Subscribe Key");c=JSON.stringify(c);c=[w,"publish",d,m,0,J(e),f,J(c)];z({a:f,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:c,data:{uuid:E}})},unsubscribe:function(a){a=a.channel;n=0;k=1;a=D((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+y}).join(",");C(a.split(","),
function(a){u&&b(a,0);g[a]=0});u&&c()},subscribe:function(a,b){function d(){var a=t(),b=K(g).join(",");b&&(j=z({timeout:ma,a:a,data:{uuid:E},url:[ea,"subscribe",m,J(b),a,n],b:function(){e(function(a){a.d||(a.d=1,a.i(a.name))});ea=v(w);setTimeout(d,SECOND);B.time(function(a){e(function(b){a&&b.d?(b.d=0,b.j(b.name)):b.error()})})},c:function(a){if(!a)return setTimeout(d,10);e(function(a){a.e||(a.e=1,a.h(a.name))});n=!n&&k&&F.get(m)||a[1];F.set(m,a[1]);var b,c=(2<a.length?a[2]:"").split(",");b=function(){var a=
c.shift()||"";return[(g[a]||{}).a||i,(a||h).split(y)[0]]};C(a[0],function(c){var d=b();if(g[d[1]].f)d[0](c,a,d[1])});setTimeout(d,10)}}))}var f=a.channel,b=(b=b||a.callback)||a.message,ja=a.error||l(),A=a.connect||l(),I=a.reconnect||l(),ka=a.disconnect||l(),T=a.presence||0,la=a.noheresync||0,ma=a.timeout||31E4,na=a.restore,ea=v(w);na&&(k=1);if(!f)return error("Missing Channel");if(!b)return error("Missing Callback");if(!m)return error("Missing Subscribe Key");C((f.join?f.join(","):""+f).split(","),
function(a){var c=g[a]||{};g[h=a]={name:a,e:c.e,d:c.d,f:1,a:i=b,h:A,error:ja,i:ka,j:I};T&&(B.subscribe({channel:a+y,callback:T}),!c.f&&!la&&B.here_now({channel:a,callback:function(b){C("uuids"in b?b.uuids:[],function(c){T({action:"join",uuid:c,timestamp:s(),occupancy:b.occupancy||1},b,a)})}}))});c=function(){j&&j();clearTimeout(r);r=setTimeout(d,100)};if(!u)return q.push(c);c()},here_now:function(a,b){var b=a.callback||b,c=a.error||l(),d=a.channel,e=t(),f={};if(!d)return error("Missing Channel");
if(!b)return error("Missing Callback");if(!m)return error("Missing Subscribe Key");"0"!=e&&(f.callback=e);z({a:e,data:f,c:function(a){b(a)},b:c,url:[w,"v2","presence","sub_key",m,"channel",J(d)]})},ready:function(){B.time(s);B.time(function(){setTimeout(function(){u||(u=1,C(q,function(a){a()}))},SECOND)})}},b=function(a,b){var c={uuid:E},d=v(w),e=t();0<a.indexOf(y)||("0"!=e&&(c.callback=e),z({g:b||A,timeout:2E3,a:e,data:c,url:[d,"v2","presence","sub_key",m,"channel",J(a),"leave"]}))};E||(E=B.uuid());
F.set(m+"uuid",E);I();f.__proto__=B;return f};PUBNUB=ia({publish_key:P($,"pub-key"),subscribe_key:P($,"sub-key"),ssl:!document.location.href.indexOf("https")||"on"==P($,"ssl"),origin:P($,"origin"),uuid:P($,"uuid")});Q($,{position:"absolute",top:-SECOND});if("opera"in window||P($,"flash"))$.innerHTML="<object id=pubnubs data=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=movie value=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=allowscriptaccess value=always></object>";var ha=L("pubnubs")||
{};N("load",window,function(){var a=PUBNUB.ready();setTimeout(a,0)});PUBNUB.rdx=function(a,c){if(!c)return U[a].onerror();U[a].responseText=unescape(c);U[a].onload()};U.id=SECOND;window.jQuery&&(window.jQuery.PUBNUB=PUBNUB);"undefined"!==typeof module&&(module.exports=PUBNUB)&&ready()};
})();
